import streamlit as st
import pandas as pd
import os
from datetime import datetime

# ржлрж╛ржЗрж▓рзЗрж░ ржирж╛ржо
FILE_NAME = 'dokan_hishab.csv'

# ржкрзЗржЬ рж╕рзЗржЯржЖржк
st.set_page_config(page_title="ржЖржорж╛рж░ ржбрж┐ржЬрж┐ржЯрж╛рж▓ ржжрзЛржХрж╛ржи", layout="wide")
st.title("ЁЯЫТ ржбрж┐ржЬрж┐ржЯрж╛рж▓ ржЕрж░рзНржбрж╛рж░ ржУ ржЗржирзНржбрж┐рзЯрж╛ ржкрзЗржорзЗржирзНржЯ ржЦрж╛рждрж╛")

# ржлрж╛ржЗрж▓ ржирж╛ ржерж╛ржХрж▓рзЗ рждрзИрж░рж┐ ржХрж░рж╛
if not os.path.exists(FILE_NAME):
    df = pd.DataFrame(columns=['рждрж╛рж░рж┐ржЦ', 'ржХрзНрж░рзЗрждрж╛рж░ ржирж╛ржо', 'ржкржгрзНржп', 'ржкрж░рж┐ржорж╛ржг', 'ржорзЛржЯ ржЯрж╛ржХрж╛ (тВ╣)', 'ржкрзЗржорзЗржирзНржЯ ржорж╛ржзрзНржпржо', 'рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕'])
    df.to_csv(FILE_NAME, index=False)

# --- ржкржгрзНржпрзЗрж░ ржкрзВрж░рзНржгрж╛ржЩрзНржЧ рждрж╛рж▓рж┐ржХрж╛ (ржмрж┐рзЬрж┐ ржУ рж╕рж┐ржЧрж╛рж░рзЗржЯ рж╕рж╣) ---
product_list = [
    # ржорзБржжрж┐ ржУ ржЕржирзНржпрж╛ржирзНржп
    "ржЖржЯрж╛ (Atta)", "ржЪрж┐ржирж┐ (Sugar)", "рж▓ржмржг (Salt)", "рж╣рж▓рзБржж (Turmeric)", "рж▓ржЩрзНржХрж╛ (Chilli)", 
    "рж╕рж░рзНрж╖рзЗрж░ рждрзЗрж▓ (Mustard Oil)", "рж░рж┐ржлрж╛ржЗржи рждрзЗрж▓ (Refined Oil)", "ржорзБрж╕рзБрж░ ржбрж╛рж▓ (Masur Dal)", 
    "ржмрж┐рж╕рзНржХрзБржЯ (Biscuit)", "ржЪрж╛ ржкрж╛рждрж╛ (Tea)", "рж╕рж╛ржмрж╛ржи (Soap)", "рж╢рзНржпрж╛ржорзНржкрзБ (Shampoo)", 
    "ржжрзБржз (Milk)", "ржорж╢рж▓рж╛ (Spices)",
    
    # ржмрж┐рзЬрж┐ (Bidi)
    "ржирж╛рж╕рж┐рж░ ржмрж┐рзЬрж┐ (Nasir Bidi)", "ржЖржХрж┐ржЬ ржмрж┐рзЬрж┐ (Akij Bidi)", "ржХрзЗрж╖рзНржЯ ржмрж┐рзЬрж┐ (Kesto Bidi)", 
    "ржмрж╛ржБрж╢ржкрж╛ржЦрж┐ ржмрж┐рзЬрж┐", "рзлрзз ржиржорзНржмрж░ ржмрж┐рзЬрж┐", "ржЕржирзНржпрж╛ржирзНржп ржмрж┐рзЬрж┐",
    
    # рж╕рж┐ржЧрж╛рж░рзЗржЯ (Cigarette)
    "ржЧрзЛрж▓рзНржб ржлрзНрж▓рзЗржХ (Gold Flake)", "ржЙржЗрж▓рж╕ (Wills)", "ржирзЗржнрж┐ ржХрж╛ржЯ (Navy Cut)", 
    "ржХрзНржпрж╛ржкрж╕рзНржЯрж╛ржи (Capstan)", "ржлрзНрж▓рзНржпрж╛ржХ (Flake)", "ржлрзЛрж░ рж╕рзНржХржпрж╝рж╛рж░ (Four Square)", 
    "ржЗржирж╕рж┐ржЧржирж┐ржЖржЗ (Insignia)", "ржХрзНрж▓рж╛рж╕рж┐ржХ (Classic)", "ржорж╛рж░рзНрж▓ржмрзЛрж░рзЛ (Marlboro)",
    "ржкрзНржпрж╛ржи ржорж╢рж▓рж╛ (Pan Masala)", "ржЕржирзНржпрж╛ржирзНржп рж╕рж┐ржЧрж╛рж░рзЗржЯ"
]

# --- ржЗржиржкрзБржЯ рж╕рзЗржХрж╢ржи ---
st.header("ЁЯУЭ ржирждрзБржи ржЕрж░рзНржбрж╛рж░ ржПржирзНржЯрзНрж░рж┐")
col1, col2 = st.columns(2)

with col1:
    customer_name = st.text_input("ЁЯСд ржХрзНрж░рзЗрждрж╛рж░ ржирж╛ржо/ржЖржЗржбрж┐")
    product = st.selectbox("ЁЯУж ржкржгрзНржп ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи", product_list)
    amount = st.number_input("тЪЦя╕П ржкрж░рж┐ржорж╛ржг (ржХрзЗржЬрж┐/ржкрж┐рж╕/ржкрзНржпрж╛ржХрзЗржЯ)", min_value=0.0, step=1.0)

with col2:
    price = st.number_input("ЁЯТ░ ржорзЛржЯ ржжрж╛ржо (тВ╣ ржЯрж╛ржХрж╛)", min_value=0)
    payment_method = st.selectbox("ЁЯТ│ ржкрзЗржорзЗржирзНржЯ ржорж╛ржзрзНржпржо", ["Google Pay", "PhonePe", "Paytm", "Cash (ржиржЧржж)"])
    status = st.radio("тЬЕ ржкрзЗржорзЗржирзНржЯ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕", ["ржмрж╛ржХрж┐ (Due)", "ржкрж░рж┐рж╢рзЛржзрж┐ржд (Paid)"])

if st.button("рж╣рж┐рж╕рж╛ржм рж╕рзЗржн ржХрж░рзБржи"):
    if customer_name and price > 0:
        now = datetime.now().strftime("%d-%m-%Y %H:%M")
        new_data = [[now, customer_name, product, amount, price, payment_method, status]]
        new_df = pd.DataFrame(new_data, columns=['рждрж╛рж░рж┐ржЦ', 'ржХрзНрж░рзЗрждрж╛рж░ ржирж╛ржо', 'ржкржгрзНржп', 'ржкрж░рж┐ржорж╛ржг', 'ржорзЛржЯ ржЯрж╛ржХрж╛ (тВ╣)', 'ржкрзЗржорзЗржирзНржЯ ржорж╛ржзрзНржпржо', 'рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕'])
        new_df.to_csv(FILE_NAME, mode='a', header=False, index=False)
        st.success(f"{customer_name} ржПрж░ {product} ржЕрж░рзНржбрж╛рж░ рж╕ржлрж▓ржнрж╛ржмрзЗ рж╕рзЗржн рж╣рзЯрзЗржЫрзЗ!")
    else:
        st.error("ржжрзЯрж╛ ржХрж░рзЗ ржХрзНрж░рзЗрждрж╛рж░ ржирж╛ржо ржПржмржВ рж╕ржарж┐ржХ ржжрж╛ржо рж▓рж┐ржЦрзБржиред")

st.divider()

# --- ржЗржирзНржбрж┐рзЯрж╛ ржкрзЗржорзЗржирзНржЯ ржЧрзЗржЯржУрзЯрзЗ (UPI) ---
st.header("тЪб ржкрзЗржорзЗржирзНржЯ ржХрж░рзБржи (UPI)")
st.info("ржирж┐ржЪрзЗрж░ UPI ржЖржЗржбрж┐рждрзЗ ржкрзЗржорзЗржирзНржЯ ржХрж░рзЗ ржХржиржлрж╛рж░рзНржо ржХрж░рзБржиред")
p_col1, p_col2 = st.columns(2)

with p_col1:
    st.subheader("Google Pay / PhonePe")
    st.write("ЁЯФС *UPI ID: yourname@okaxis*") # ржПржЦрж╛ржирзЗ ржЖржкржирж╛рж░ ржирж┐ржЬрзЗрж░ UPI ID ржжрж┐ржи
    st.write("ЁЯУЮ *Mobile: +91 XXXXX XXXXX*")

with p_col2:
    st.subheader("Paytm")
    st.write("ЁЯФС *UPI ID: yourname@paytm*")

st.divider()

# --- рж░рж┐ржкрзЛрж░рзНржЯ рж╕рзЗржХрж╢ржи ---
st.header("ЁЯУК ржЖржЬржХрзЗрж░ ржмрж┐ржХрзНрж░рж┐рж░ рждрж╛рж▓рж┐ржХрж╛")
if os.path.exists(FILE_NAME):
    df_display = pd.read_csv(FILE_NAME)
    st.dataframe(df_display.tail(15), use_container_width=True)

    # ржбрж╛ржЙржирж▓рзЛржб ржмрж╛ржЯржи
    csv = df_display.to_csv(index=False).encode('utf-8')
    st.download_button("ЁЯУе ржкрзБрж░рзЛ рж░рж┐ржкрзЛрж░рзНржЯ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи (CSV)", csv, "store_report.csv", "text/csv")
