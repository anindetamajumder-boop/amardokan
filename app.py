import streamlit as st
import pandas as pd
import os
from datetime import datetime

# ‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶∏‡¶Æ‡ßÇ‡¶π
ORDER_FILE = 'dokan_hishab.csv'
USER_FILE = 'customers.csv'

# ‡¶™‡ßá‡¶ú ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
st.set_page_config(page_title="‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶¶‡ßã‡¶ï‡¶æ‡¶®", layout="centered")

# ‡¶´‡¶æ‡¶á‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ
if not os.path.exists(ORDER_FILE):
    pd.DataFrame(columns=['‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ', '‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ', '‡¶™‡¶£‡ßç‡¶Ø', '‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£', '‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ (‚Çπ)', '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ', '‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏']).to_csv(ORDER_FILE, index=False)
if not os.path.exists(USER_FILE):
    pd.DataFrame(columns=['‡¶®‡¶æ‡¶Æ', '‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ']).to_csv(USER_FILE, index=False)

st.title("üõí ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤")

# --- ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ---
menu = ["‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®", "‡¶ï‡ßá‡¶®‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ (‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞)", "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨"]
choice = st.sidebar.selectbox("‡¶Æ‡ßá‡¶®‡ßÅ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", menu)

# --- ‡ßß. ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ---
if choice == "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®":
    st.header("üë§ ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®")
    reg_name = st.text_input("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ")
    reg_phone = st.text_input("‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞")
    reg_address = st.text_area("‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)")
    
    if st.button("‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®"):
        if reg_name and reg_phone:
            user_df = pd.read_csv(USER_FILE)
            if reg_phone in user_df['‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞'].astype(str).values:
                st.warning("‡¶è‡¶á ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ö‡¶≤‡¶∞‡ßá‡¶°‡¶ø ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá‡•§")
            else:
                new_user = pd.DataFrame([[reg_name, reg_phone, reg_address]], columns=['‡¶®‡¶æ‡¶Æ', '‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ'])
                new_user.to_csv(USER_FILE, mode='a', header=False, index=False)
                st.success(f"‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶® {reg_name}! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶è‡¶ñ‡¶® '‡¶ï‡ßá‡¶®‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ' ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§")
        else:
            st.error("‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶¶‡¶ø‡¶®‡•§")

# --- ‡ß®. ‡¶ï‡ßá‡¶®‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ (‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞) ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ---
elif choice == "‡¶ï‡ßá‡¶®‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ (‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞)":
    st.header("üõçÔ∏è ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®")
    user_df = pd.read_csv(USER_FILE)
    
    if user_df.empty:
        st.info("‡¶Ü‡¶ó‡ßá '‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®' ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶æ‡¶Æ ‡¶®‡¶•‡¶ø‡¶≠‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§")
    else:
        # ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶æ‡¶Æ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ
        customer_list = user_df['‡¶®‡¶æ‡¶Æ'].tolist()
        customer_name = st.selectbox("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®", customer_list)
        
        # ‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü (‡¶¨‡¶ø‡ßú‡¶ø ‡¶ì ‡¶∏‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶ü ‡¶∏‡¶π)
        product_list = [
            "‡¶Ü‡¶ü‡¶æ (Atta)", "‡¶ö‡¶ø‡¶®‡¶ø (Sugar)", "‡¶≤‡¶¨‡¶£ (Salt)", "‡¶∏‡¶∞‡ßç‡¶∑‡ßá‡¶∞ ‡¶§‡ßá‡¶≤", "‡¶Æ‡ßÅ‡¶∏‡ßÅ‡¶∞ ‡¶°‡¶æ‡¶≤",
            "‡¶®‡¶æ‡¶∏‡¶ø‡¶∞ ‡¶¨‡¶ø‡ßú‡¶ø", "‡¶Ü‡¶ï‡¶ø‡¶ú ‡¶¨‡¶ø‡ßú‡¶ø", "‡¶ï‡ßá‡¶∑‡ßç‡¶ü ‡¶¨‡¶ø‡ßú‡¶ø", "‡ß´‡ßß ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡¶ø‡ßú‡¶ø",
            "‡¶ó‡ßã‡¶≤‡ßç‡¶° ‡¶´‡ßç‡¶≤‡ßá‡¶ï (Gold Flake)", "‡¶â‡¶á‡¶≤‡¶∏ (Wills)", "‡¶®‡ßá‡¶≠‡¶ø ‡¶ï‡¶æ‡¶ü", "‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ï", "‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡¶ø‡¶ï", "‡¶Æ‡¶æ‡¶∞‡ßç‡¶≤‡¶¨‡ßã‡¶∞‡ßã"
        ]
        product = st.selectbox("‡¶™‡¶£‡ßç‡¶Ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", product_list)
        amount = st.number_input("‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡¶ï‡ßá‡¶ú‡¶ø/‡¶™‡¶ø‡¶∏)", min_value=1.0, step=1.0)
        price = st.number_input("‡¶Æ‡ßã‡¶ü ‡¶¶‡¶æ‡¶Æ (‚Çπ ‡¶ü‡¶æ‡¶ï‡¶æ)", min_value=0)
        
        pay_method = st.selectbox("‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ", ["Google Pay", "PhonePe", "Paytm", "Cash"])
        status = "Paid" if st.checkbox("‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶ñ‡¶®‡¶á ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡¶ø") else "Due"

        if st.button("‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®"):
            if price > 0:
                now = datetime.now().strftime("%d-%m-%Y %H:%M")
                new_order = pd.DataFrame([[now, customer_name, product, amount, price, pay_method, status]], 
                                         columns=['‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ', '‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ', '‡¶™‡¶£‡ßç‡¶Ø', '‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£', '‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ (‚Çπ)', '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ', '‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏'])
                new_order.to_csv(ORDER_FILE, mode='a', header=False, index=False)
                st.success("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶¶‡ßá‡¶¨‡•§")
                st.balloons()

# --- ‡ß©. ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶§‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶¶‡ßá‡¶ñ‡¶¨‡ßá ---
elif choice == "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨":
    st.header("üìä ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßá‡¶®‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏")
    user_df = pd.read_csv(USER_FILE)
    if not user_df.empty:
        search_name = st.selectbox("‡¶ï‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?", user_df['‡¶®‡¶æ‡¶Æ'].tolist())
        order_df = pd.read_csv(ORDER_FILE)
        my_orders = order_df[order_df['‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ'] == search_name]
        
        if not my_orders.empty:
            st.table(my_orders)
            total_spent = my_orders['‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ (‚Çπ)'].sum()
            st.subheader(f"‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶ï‡ßá‡¶®‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ: ‚Çπ {total_spent}")
        else:
            st.info("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§")

# --- ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏ (‡¶®‡¶ø‡¶ö‡ßá ‡¶∏‡¶¨ ‡¶∏‡¶Æ‡ßü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá) ---
st.divider()
st.sidebar.markdown("### ‚ö° ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® (UPI)")
st.sidebar.write("Google Pay / PhonePe: *yourname@okaxis*")
st.sidebar.write("Paytm: *yourname@paytm*")
